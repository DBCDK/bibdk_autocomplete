<?php

/**
 * @file
 * bibdk_autocomplete web testcase
 */
class BibdkAutocompleteWebTestCase extends DrupalWebTestCase {

  protected $privileged_user;

  public static function getInfo() {
    return array(
      'name' => 'Autocomplete Web Test',
      'description' => 'Bibdk Autocomplete test.',
      'group' => 'Bibliotek.dk - Autocomplete',
    );
  }

  public function setUp() {
    // $this->profile = 'minimal';
    parent::setUp('bibdk_autocomplete', 'bibdk_custom_search', 'uuid');
    user_role_grant_permissions(DRUPAL_ANONYMOUS_RID, array(
      'access content',
      'search content'
    ));
    menu_rebuild();
  }

  public function testRunner() {

    // Create and log in our privileged user.
    $this->privileged_user = $this->drupalCreateUser(array(
      'administer bibdk custom search pages',
      'administer search',
      'administer blocks',
      'search content',
    ));
    $this->drupalLogin($this->privileged_user);
    $this->_testBibdkCustomSearchCreatePage();
    $this->_testBibdkAutocompleteAdmin();
  }

  /*
   * Autocomplete settings.
   */
  private function _testBibdkAutocompleteAdmin() {
    $this->drupalGet('admin/config/search/bibdk_autocomplete');
    $this->assertField('bibdk_autocomplete_rest_url', 'bibdk_autocomplete_rest_url is present');
  }
}
